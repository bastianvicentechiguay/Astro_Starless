---
import { Image } from "astro:assets";
import { STRAPI_BASE_URL } from "../lib/conection";

export interface Props {
  tag?: string;
  titulo: string;
  resumen?: string;
  portada?: any; 
  slug?: string;
}

const { tag = "", titulo, resumen = "", portada, slug } = Astro.props as Props;

// cambia la URL de la imagen a una URL completa 
let imageUrl: string | null = null;

if (portada) {
  if (typeof portada === "string") {
    imageUrl = portada.startsWith("http")
      ? portada
      : portada.startsWith("/")
        ? `${STRAPI_BASE_URL}${portada}`
        : portada;
  } else if (typeof portada === "object") {
    // soporta varias formas devueltas por Strapi
    const data = portada.data ?? portada;
    const url =
      data?.attributes?.url ??
      data?.url ??
      (Array.isArray(data) ? data[0]?.attributes?.url : undefined);
    if (url)
      imageUrl = url.startsWith("http") ? url : `${STRAPI_BASE_URL}${url}`;
  }
}
---

<article
  class="group flex flex-col md:flex-row gap-6 md:gap-8 items-start w-full"
>
  <a
    class="block shrink-0 w-full md:w-72 aspect-square overflow-hidden rounded-2xl"
    href={`/${tag}/${slug}`}
  >
    {
      imageUrl ? (
        <Image
          src={imageUrl}
          alt={titulo}
          class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500 ease-out"
          inferSize={true}
        />
      ) : (
        <img
          src="/assets/default.jpg"
          alt={titulo}
          class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500 ease-out"
        />
      )
    }
  </a>

  <div class="flex flex-col justify-center min-w-0 flex-1 py-2">
    <div class="mb-3">
      <span
        class="inline-block bg-black text-white text-xs font-bold px-3 py-1 rounded-sm uppercase tracking-wide"
      >
        {tag}
      </span>
    </div>

    <a href={`/${tag}/${slug}`}>
      <h3
        class="text-2xl md:text-3xl font-bold leading-tight text-gray-900 mb-3 group-hover:text-gray-600 transition-colors"
      >
        {titulo}
      </h3>
    </a>

    <p class="text-base text-gray-600 leading-relaxed line-clamp-3">
      {resumen}
    </p>
  </div>
</article>
